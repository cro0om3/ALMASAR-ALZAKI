# لوكل مقابل أونلاين — ما الذي يعقّد الأمور؟

المتغيرات من Supabase **نفسها** محلياً وأونلاين. التعقيد ليس في القيم، بل في **أين تُحمّل** ومن **أين يقرأ التطبيق**.

---

## 1. من أين يقرأ التطبيق المتغيرات؟

| البيئة | مصدر المتغيرات |
|--------|-----------------|
| **محلي (localhost)** | ملف `.env.local` على جهازك — التطبيق يقرأه تلقائياً. |
| **أونلاين (Vercel)** | **Environment Variables** في لوحة Vercel — يجب إضافتها يدوياً (أو عبر سكربت/API) لأن Vercel لا يقرأ ملف `.env.local` من المشروع. |

لذلك: حتى لو كانت القيم صحيحة في `.env.local`، التطبيق على Vercel **لا يرى هذا الملف**. يجب أن تكون نفس القيم مضبوطة في **Vercel → Settings → Environment Variables**.

---

## 2. ما الذي كان يعقّد الأمور عند النشر أونلاين؟

1. **Invalid API key**
   - **السبب:** على Vercel لم تكن متغيرات Supabase (URL + Anon Key + Service Role Key) مضبوطة، أو كانت من مشروع آخر.
   - **الحل:** إضافة المتغيرات نفسها من Supabase إلى Vercel (تم عبر سكربت `vercel-add-env.js` + `env-for-vercel.txt`).

2. **Invalid PIN code**
   - **السبب:** تسجيل الدخول يقرأ المستخدمين من جدول `users` في **Supabase**. محلياً قد يكون المستخدم admin موجوداً في قاعدة أخرى أو تم إنشاؤه سابقاً؛ على Vercel التطبيق يقرأ من Supabase فقط — فإذا لم يكن مستخدم بـ PIN 1234 موجوداً هناك، يفشل الدخول.
   - **الحل:** إنشاء/تحديث مستخدم admin في **نفس Supabase** (جدول `users`) بكلمة مرور = hash لـ 1234 (تم عبر سكربت `create-admin-user-supabase.js`).

3. **Build يفشل (مثلاً Prisma / test-db)**
   - **السبب:** أثناء البناء على Vercel قد لا يكون `DATABASE_URL` متوفراً أو قد تُستدعى مسارات تحتاج اتصالاً بقاعدة البيانات.
   - **الحل:** تأجيل إنشاء Prisma Client حتى يكون `DATABASE_URL` موجوداً، وإزالة أو عدم استدعاء مسارات الفحص أثناء البناء.

---

## 3. الخلاصة

- **المتغيرات صحيحة من Supabase** — نفس القيم نستخدمها محلياً وأونلاين.
- **التعقيد أونلاين:**
  1. أن **Vercel** لا يقرأ `.env.local` — يجب إضافة المتغيرات في لوحة Vercel.
  2. أن **البيانات** (مثل مستخدم الدخول) يجب أن تكون في **نفس Supabase** الذي يتصل به التطبيق على Vercel.

بعد ضبط المتغيرات على Vercel ووجود مستخدم admin في Supabase، السلوك يصبح مطابقاً للمحلي.
